{% extends '_list.html' %}

{% block columns %}
        <th scope="col">Dispositivo</th>
        <th scope="col">Tipo</th>
        <th scope="col">IP</th>
        <th scope="col">Estado</th>
        <th scope="col"></th>
{% endblock %}

{% block rows %}
    
    {% for device,active in zlist %}
        
        <tr class="text-center align-items-center">
            <td scope="row">{{device.slug}}</td>
            
            <td scope="row">
                <span class=" badge bg-{% if device.type == 'T' %}success{% elif device.type == 'U' %}purple{% endif %}">
                    <div class="h6 m-0 ">
                        {{device.get_type_display}}
                    </div>
                </span>
            </td>
            <td scope="row">{{device.ip}}</td>
            <td scope="row ">
                <p>
                    <span class="badge bg-{% if active == True %}success{% else %}danger{% endif %}">
                        {% if active == True %}
                            Conectado
                        {% else %}
                            Desconectado
                        {% endif %}
                    </span>
                </p>
            </td>
            <td>
                
                
            <a href="{% url 'modbus_update' device.id %}" data-toggle="tooltip" title="Eliminar" class="m-1 btn btn-warning btn-xs btn-flat">
                <i class="fas fa-edit"></i>
            </a>
            {% if active == True %}
                <a href="{% url 'modbus_device' device.id %}" data-toggle="tooltip" title="Graficar" class="m-1 btn btn-success btn-xs btn-flat">
                    <svg  height="1em" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M160 80c0-26.5 21.5-48 48-48h32c26.5 0 48 21.5 48 48V432c0 26.5-21.5 48-48 48H208c-26.5 0-48-21.5-48-48V80zM0 272c0-26.5 21.5-48 48-48H80c26.5 0 48 21.5 48 48V432c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V272zM368 96h32c26.5 0 48 21.5 48 48V432c0 26.5-21.5 48-48 48H368c-26.5 0-48-21.5-48-48V144c0-26.5 21.5-48 48-48z"/></svg>
                </a>

                <a href="{% url 'modbus_iden' device.id %}" data-toggle="tooltip" title="Identificar Systema" class="m-1 btn btn-info btn-xs btn-flat">
                    <svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 460 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M220.6 130.3l-67.2 28.2V43.2L98.7 233.5l54.7-24.2v130.3l67.2-209.3zm-83.2-96.7l-1.3 4.7-15.2 52.9C80.6 106.7 52 145.8 52 191.5c0 52.3 34.3 95.9 83.4 105.5v53.6C57.5 340.1 0 272.4 0 191.6c0-80.5 59.8-147.2 137.4-158zm311.4 447.2c-11.2 11.2-23.1 12.3-28.6 10.5-5.4-1.8-27.1-19.9-60.4-44.4-33.3-24.6-33.6-35.7-43-56.7-9.4-20.9-30.4-42.6-57.5-52.4l-9.7-14.7c-24.7 16.9-53 26.9-81.3 28.7l2.1-6.6 15.9-49.5c46.5-11.9 80.9-54 80.9-104.2 0-54.5-38.4-102.1-96-107.1V32.3C254.4 37.4 320 106.8 320 191.6c0 33.6-11.2 64.7-29 90.4l14.6 9.6c9.8 27.1 31.5 48 52.4 57.4s32.2 9.7 56.8 43c24.6 33.2 42.7 54.9 44.5 60.3s.7 17.3-10.5 28.5zm-9.9-17.9c0-4.4-3.6-8-8-8s-8 3.6-8 8 3.6 8 8 8 8-3.6 8-8z"/></svg>
                </a> 
            {% endif %}
            
            <a href="{% url 'modbus_delete' device.id %}" data-toggle="tooltip" title="Eliminar" class="m-1 btn btn-danger btn-xs btn-flat">
                <i class="fas fa-regular fa-trash"></i>
            </a>
                
            </td>
        </tr>
    {% endfor %}

{% endblock %}
{% block box_footer_buttons %}
    <a href="{% url 'modbus_create' %}" class="btn btn-primary btn-flat">
        <i class="fas fa-plus"></i> Agregar Modbus 
    </a>
    <a href="" class="btn btn-success btn-flat" >
        <i class="fas fa-sync-alt"></i> Actualizar
    </a>
    
{% endblock %}

{% block modal_content %}
<div class="modal fade" id="modal-lg" aria-modal="true" role="dialog">
    <div class="modal-dialog modal-lg">
    <div class="modal-content">
    <div class="modal-header">
    <h4 class="modal-title">I2C Scan</h4>
    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
    <span aria-hidden="true">Ã—</span>
    </button>
    </div>
    <div class="modal-body">
    
        <div id="content" >
        
        </div>
    </div>
    <div class="modal-footer justify-content-between">
    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
    <button type="button" onclick="scan()" class="btn btn-warning btn-flat" >Scan</button>
    </div>
    </div>
    
    </div>
    
    </div>
    <script>
        function  scan() {
            $.ajax({
                url: "{% url 'i2c_list' %}",
                data: {
                    "action":'scan',      
                },
                type: 'POST',
                headers: {
                    'X-CSRFToken': csrftoken
                },
                dataType: 'json',
                success: function (request) {
                    elem=document.getElementById('content')
                    elem.innerHTML="<div class='container'>"
                    request.response.forEach(element => {
                        elem.innerHTML+="<div class='row text-center' m-2>"
                            elem.innerHTML+="<div class='col-6'>"
                                elem.innerHTML+=element
                            elem.innerHTML+="</div>"
                            elem.innerHTML+="<div class='col-6'>"
                                elem.innerHTML+=
                                "
                                <a href='{% url 'i2c_create'  %}' data-toggle='tooltip' title='Crear' class='m-1 btn btn-success btn-xs btn-flat'>\
                                    <i class='fas fa-edit'></i>\
                                </a>\
                                "
                            elem.innerHTML+="</div>"
                        elem.innerHTML+="</div>"
                    });
                    elem.innerHTML="</div>"
                },
                error: function (jqXHR, textStatus, errorThrown) {
                        }
            })
        }
    </script>    
{% endblock  %}